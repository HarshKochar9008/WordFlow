<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WordFlow</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  
  <style>
    :root {
      /* Light Theme (Default) */
      --primary: #0066cc;
      --primary-dark: #0052a3;
      --accent: #00b894;
      --danger: #e74c3c;
      --bg: #f8fafd;
      --sidebar: #fff;
      --card-bg: #fff;
      --text-primary: #222;
      --text-secondary: #333;
      --text-muted: #666;
      --border: #cfd8dc;
      --input-bg: #f4f8fb;
      --input-border: #cfd8dc;
      --shadow: 0 8px 32px rgba(0,0,0,0.10);
      --radius: 18px;
      --transition: 0.18s;
    }

    /* Dark Theme */
    [data-theme="dark"] {
      --primary: #4dabf7;
      --primary-dark: #339af0;
      --accent: #51cf66;
      --danger: #ff6b6b;
      --bg: #1a1a1a;
      --sidebar: #2d2d2d;
      --card-bg: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #e9ecef;
      --text-muted: #adb5bd;
      --border: #495057;
      --input-bg: #343a40;
      --input-border: #495057;
      --shadow: 0 8px 32px rgba(0,0,0,0.30);
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      transition: background var(--transition), color var(--transition);
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      width: 260px;
      background: var(--sidebar);
      box-shadow: 2px 0 16px rgba(0,0,0,0.04);
      display: flex;
      flex-direction: column;
      padding: 32px 0 0 0;
      border-top-right-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      min-height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 10;
      transition: background var(--transition), box-shadow var(--transition);
    }
    .sidebar h2 {
      text-align: center;
      color: var(--primary);
      font-size: 1.5rem;
      margin-bottom: 32px;
      font-weight: 800;
      letter-spacing: 1px;
      transition: color var(--transition);
    }
    .nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 18px;
    }
    .nav-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.08rem;
      padding: 12px 18px;
      border-radius: 8px;
      text-align: left;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
      font-weight: 500;
    }
    .nav-btn.active, .nav-btn:hover, .nav-btn:focus {
      background: var(--primary);
      color: #fff;
      outline: none;
    }
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1.5px solid var(--border);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--transition), border var(--transition);
      color: var(--text-secondary);
      font-size: 1.2rem;
    }
    .theme-toggle:hover {
      background: var(--input-bg);
      border-color: var(--primary);
      color: var(--primary);
    }
    .main {
      margin-left: 240px;
      flex: 1;
      padding: 40px 0 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .tool-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 36px 28px 28px 28px;
      width: 100%;
      max-width: 650px;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      transition: box-shadow var(--transition), background var(--transition);
    }
    .tool-card h1 {
      color: var(--primary);
      font-size: 2rem;
      margin: 0 0 10px 0;
      text-align: center;
      font-weight: 800;
      letter-spacing: 1px;
      transition: color var(--transition);
    }
    .controls, .replace-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }
    .controls input[type="file"] {
      font-size: 1rem;
      border: none;
      background: none;
      color: var(--text-secondary);
    }
    .action-btn, .replace-btn {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 18px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), box-shadow var(--transition), transform 0.12s;
      box-shadow: 0 2px 8px rgba(0,102,204,0.07);
      outline: none;
    }
    .action-btn:hover, .action-btn:focus, .replace-btn:hover, .replace-btn:focus {
      background: var(--primary-dark);
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 4px 16px rgba(0,102,204,0.13);
    }
    .textarea-wrap {
      position: relative;
      width: 100%;
    }
    textarea {
      width: 100%;
      min-height: 180px;
      font-size: 1.13rem;
      padding: 16px 14px;
      border-radius: 10px;
      border: 1.5px solid var(--input-border);
      resize: vertical;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: border 0.2s, box-shadow 0.2s, background var(--transition), color var(--transition);
      font-family: inherit;
      box-sizing: border-box;
    }
    textarea:focus {
      border: 2px solid var(--primary);
      outline: none;
      background: var(--card-bg);
      box-shadow: 0 2px 12px rgba(0,102,204,0.1);
    }
    .highlight {
      border: 2px solid var(--accent) !important;
      box-shadow: 0 0 0 2px rgba(0,184,148,0.2);
      transition: border 0.2s, box-shadow 0.2s;
    }
    .count-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 10px;
    }
    .word-count, .char-count, .sentence-count, .para-count, .reading-time {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--primary);
      user-select: none;
      transition: color var(--transition);
    }
    .count-animate {
      color: var(--accent) !important;
      transform: scale(1.13);
    }
    .utility-btns {
      display: flex;
      gap: 10px;
    }
    .utility-btn {
      background: var(--input-bg);
      color: var(--primary);
      border: 1.2px solid var(--input-border);
      border-radius: 7px;
      padding: 7px 14px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition), border var(--transition), color var(--transition);
      outline: none;
    }
    .utility-btn:hover, .utility-btn:focus {
      background: var(--card-bg);
      border: 1.5px solid var(--primary);
      color: var(--primary-dark);
    }
    .toast {
      position: absolute;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: var(--accent);
      color: #fff;
      padding: 10px 28px;
      border-radius: 8px;
      font-size: 1.08rem;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, bottom 0.3s;
      z-index: 10;
      box-shadow: 0 2px 12px rgba(0,184,148,0.3);
    }
    .toast.show {
      opacity: 1;
      bottom: 38px;
      pointer-events: auto;
    }
    .highlight-search {
      background: #ffeaa7;
      color: #d35400;
      border-radius: 3px;
      padding: 0 2px;
    }
    .replace-controls {
      margin-top: 10px;
      justify-content: flex-start;
    }
    .replace-btn {
      margin-left: 8px;
      background: var(--accent);
      color: #fff;
    }
    .replace-btn:hover, .replace-btn:focus {
      background: #00a07a;
    }
    .case-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .case-btn {
      background: var(--input-bg);
      color: var(--primary);
      border: 1.2px solid var(--input-border);
      border-radius: 7px;
      padding: 7px 14px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition), border var(--transition), color var(--transition);
      outline: none;
    }
    .case-btn:hover, .case-btn:focus {
      background: var(--card-bg);
      border: 1.5px solid var(--primary);
      color: var(--primary-dark);
    }
    .prompt-btn {
      background: var(--input-bg);
      color: var(--primary);
      border: 1.2px solid var(--input-border);
      border-radius: 7px;
      padding: 8px 16px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition), border var(--transition), color var(--transition);
      outline: none;
    }
    .prompt-btn:hover, .prompt-btn:focus {
      background: var(--card-bg);
      border: 1.5px solid var(--primary);
      color: var(--primary-dark);
    }
    .prompt-btn.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .ai-status {
      background: var(--input-bg);
      border: 1.5px solid var(--input-border);
      color: var(--text-secondary);
      transition: background var(--transition), border var(--transition), color var(--transition);
    }
    .ai-status.loading {
      background: #fff3cd;
      border-color: #ffeaa7;
      color: #856404;
    }
    .ai-status.success {
      background: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    .ai-status.error {
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
    .api-key-status {
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 500;
    }
    .api-key-status.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .api-key-status.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .api-key-status.info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    input[type="text"], input[type="email"], input[type="password"], input[type="number"], select {
      background: var(--input-bg);
      color: var(--text-primary);
      border: 1.5px solid var(--input-border);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 1rem;
      transition: border var(--transition), background var(--transition), color var(--transition);
    }
    input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      background: var(--card-bg);
    }
    label {
      color: var(--text-secondary);
      transition: color var(--transition);
    }
    #dropZone {
      border: 2px dashed var(--primary);
      color: var(--text-secondary);
      transition: background var(--transition), color var(--transition);
    }
    #dropZone:hover {
      background: var(--input-bg);
    }
    @media (max-width: 900px) {
      .sidebar {
        width: 100vw;
        min-height: unset;
        height: auto;
        flex-direction: row;
        border-radius: 0;
        box-shadow: none;
        position: static;
        padding: 0;
        justify-content: space-between;
        align-items: center;
      }
      .sidebar h2 {
        margin-bottom: 0;
        font-size: 1.1rem;
        padding: 12px 0;
      }
      .sidebar img {
        width: 48px !important;
        margin: 0 8px 0 8px !important;
      }
      .nav {
        flex-direction: row;
        gap: 0;
        padding: 0 4px;
        flex: 1;
        justify-content: flex-end;
      }
      .nav-btn {
        flex: 1;
        padding: 10px 4px;
        font-size: 0.98rem;
        border-radius: 0;
        text-align: center;
      }
      .main {
        margin-left: 0;
        padding: 16px 0 16px 0;
      }
      .tool-card {
        padding: 18px 4vw 18px 4vw;
        border-radius: 0;
        box-shadow: none;
      }
      .toast {
        left: 50% !important;
        transform: translateX(-50%) !important;
      }
      .theme-toggle {
        position: static;
        margin: 0 8px;
        top: 200px;
        right: 20px;
      }
    }
    @media (max-width: 600px) {
      .tool-card {
        padding: 8px 2vw 8px 2vw;
      }
      .main {
        padding: 4px 0 4px 0;
      }
      .sidebar {
        flex-direction: column;
        align-items: flex-start;
        padding: 8px 0 0 0;
      }
      .sidebar img {
        width: 38px !important;
        margin: 0 0 8px 12px !important;
      }
      .sidebar h2 {
        font-size: 1rem;
        padding: 6px 0;
        margin-bottom: 8px;
      }
      .nav {
        flex-direction: column;
        width: 100%;
        gap: 2px;
        padding: 0 2px;
      }
      .nav-btn {
        font-size: 0.95rem;
        padding: 8px 2px;
      }
      .tool-card h1 {
        font-size: 1.2rem;
      }
      textarea {
        font-size: 1rem;
        min-height: 120px;
      }
      .ai-controls {
        flex-direction: column;
        align-items: stretch;
      }
      .ai-controls input[type="password"] {
        min-width: unset;
      }
      .prompt-templates {
        justify-content: center;
      }
      .prompt-btn {
        font-size: 0.9rem;
        padding: 6px 12px;
      }
      .ai-options {
        flex-direction: column;
        align-items: stretch;
      }
      .ai-actions {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
    /* Profile Section Styles */
    .profile-section {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }
    
    .profile-toggle {
      background: var(--card-bg);
      border: 1.5px solid var(--border);
      border-radius: 50%;
      width: 45px;
      height: 45px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
      color: var(--text-secondary);
      font-size: 1.3rem;
      box-shadow: var(--shadow);
    }
    
    .profile-toggle:hover {
      background: var(--input-bg);
      border-color: var(--primary);
      color: var(--primary);
      transform: scale(1.05);
    }
    
    .profile-dropdown {
      position: absolute;
      top: 55px;
      right: 0;
      background: var(--card-bg);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      min-width: 220px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all var(--transition);
      z-index: 1000;
    }
    
    .profile-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .profile-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      text-align: center;
    }
    
    .profile-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0 auto 8px;
    }
    
    .profile-email {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-weight: 500;
      word-break: break-all;
    }
    
    .profile-menu {
      padding: 8px 0;
    }
    
    .profile-menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: background var(--transition), color var(--transition);
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }
    
    .profile-menu-item:hover {
      background: var(--input-bg);
      color: var(--primary);
    }
    
    .profile-menu-item.danger {
      color: var(--danger);
    }
    
    .profile-menu-item.danger:hover {
      background: #fef2f2;
      color: var(--danger);
    }
    
    .profile-menu-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }
    
    /* Edit Profile Modal */
    .edit-profile-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }
    
    .edit-profile-content {
      background: var(--card-bg);
      padding: 32px 28px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      max-width: 450px;
      width: 90%;
      display: flex;
      flex-direction: column;
      gap: 20px;
      border: 1px solid var(--border);
    }
    
    .edit-profile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .edit-profile-title {
      color: var(--text-primary);
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: color var(--transition);
    }
    
    .close-btn:hover {
      color: var(--text-primary);
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .form-group input {
      padding: 12px 16px;
      border-radius: 8px;
      border: 1.5px solid var(--input-border);
      font-size: 1rem;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: border var(--transition);
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .edit-profile-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    
    .edit-profile-actions .action-btn {
      flex: 1;
    }
    
    .edit-profile-actions .utility-btn {
      flex: 1;
    }
    
    .profile-error {
      color: var(--danger);
      font-size: 0.9rem;
      text-align: center;
      min-height: 20px;
    }
    
    .profile-success {
      color: var(--accent);
      font-size: 0.9rem;
      text-align: center;
      min-height: 20px;
    }
  </style>
</head>
<body>
  <nav class="sidebar" id="sidebarNav">
    <div style="display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:10px;margin-top:10px;">
      <img src="WordFlow.png" alt="WordFlow Logo" style="display:block;width:80px;height:auto;margin:0 8px 0 8px;" />
      <h2 style="flex:1;text-align:center;margin:0;">WordFlow</h2>
      <button id="sidebarToggle" style="background:none;border:none;display:none;flex-direction:column;gap:3px;padding:8px 12px;cursor:pointer;outline:none;" aria-label="Toggle navigation">
        <span style="width:24px;height:3px;background:var(--primary);display:block;border-radius:2px;"></span>
        <span style="width:24px;height:3px;background:var(--primary);display:block;border-radius:2px;"></span>
        <span style="width:24px;height:3px;background:var(--primary);display:block;border-radius:2px;"></span>
      </button>
    </div>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <span id="themeIcon">🌙</span>
    </button>
    <div class="nav" id="sidebarNavLinks">
      <button class="nav-btn active" data-tool="wordcount">Word Count</button>
      <button class="nav-btn" data-tool="search">Search</button>
      <button class="nav-btn" data-tool="replace">Replace</button>
      <button class="nav-btn" data-tool="stats">Statistics</button>
      <button class="nav-btn" data-tool="case">Case Converter</button>
      <button class="nav-btn" data-tool="aiWriter">AI Writer</button>
      <button class="nav-btn" data-tool="download">Download</button>
    </div>
  </nav>
  
  <!-- Profile Section -->
  <div class="profile-section" id="profileSection" style="display: none;">
    <button class="profile-toggle" id="profileToggle">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    </button>
    
    <div class="profile-dropdown" id="profileDropdown">
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">U</div>
        <div class="profile-email" id="profileEmail">user@example.com</div>
      </div>
      
      <div class="profile-menu">
        <button class="profile-menu-item" id="editProfileBtn">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          Edit Profile
        </button>
        
        <button class="profile-menu-item" id="settingsBtn">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
          </svg>
          Settings
        </button>
        
        <button class="profile-menu-item" id="helpBtn">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
          </svg>
          Help & Support
        </button>
        
        <div style="height: 1px; background: var(--border); margin: 8px 0;"></div>
        
        <button class="profile-menu-item danger" id="logoutBtnNew">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
          </svg>
          Logout
        </button>
      </div>
    </div>
  </div>
  
  <!-- Edit Profile Modal -->
  <div class="edit-profile-modal" id="editProfileModal">
    <div class="edit-profile-content">
      <div class="edit-profile-header">
        <h3 class="edit-profile-title">Edit Profile</h3>
        <button class="close-btn" id="closeEditProfile">&times;</button>
      </div>
      
      <div class="form-group">
        <label for="editDisplayName">Display Name</label>
        <input type="text" id="editDisplayName" placeholder="Enter your display name">
      </div>
      
      <div class="form-group">
        <label for="editEmail">Email</label>
        <input type="email" id="editEmail" placeholder="Enter your email" readonly>
      </div>
      
      <div class="form-group">
        <label for="editBio">Bio</label>
        <input type="text" id="editBio" placeholder="Tell us about yourself">
      </div>
      
      <div class="edit-profile-actions">
        <button class="action-btn" id="saveProfileBtn">Save Changes</button>
        <button class="utility-btn" id="cancelEditProfile">Cancel</button>
      </div>
      
      <div class="profile-error" id="profileError"></div>
      <div class="profile-success" id="profileSuccess"></div>
    </div>
  </div>
  
  <!-- Auth Modal -->
  <div id="authModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(4px);">
    <div style="background:var(--card-bg);padding:32px 28px;border-radius:var(--radius);box-shadow:var(--shadow);max-width:380px;width:90%;display:flex;flex-direction:column;gap:20px;align-items:center;transition:background var(--transition);border:1px solid var(--border);">
      <h2 id="authTitle" style="color:var(--text-primary);transition:color var(--transition);margin:0;font-size:1.8rem;font-weight:700;">Sign In</h2>
      <input id="authEmail" type="email" placeholder="Email" style="width:100%;padding:12px 16px;border-radius:8px;border:1.5px solid var(--input-border);font-size:1rem;background:var(--input-bg);color:var(--text-primary);transition:border var(--transition),background var(--transition);" />
      <input id="authPassword" type="password" placeholder="Password" style="width:100%;padding:12px 16px;border-radius:8px;border:1.5px solid var(--input-border);font-size:1rem;background:var(--input-bg);color:var(--text-primary);transition:border var(--transition),background var(--transition);" />
      <button id="loginBtn" class="action-btn" style="width:100%;padding:12px;font-size:1.1rem;">Login</button>
      <button id="signupBtn" class="utility-btn" style="width:100%;padding:12px;font-size:1.1rem;">Sign Up</button>
      <div style="width:100%;text-align:center;color:var(--text-muted);font-size:0.95rem;transition:color var(--transition);position:relative;">
        <span style="background:var(--card-bg);padding:0 12px;">or</span>
        <div style="position:absolute;top:50%;left:0;right:0;height:1px;background:var(--border);z-index:-1;"></div>
      </div>
      <button id="googleBtn" class="action-btn" style="width:100%;padding:12px;font-size:1.1rem;background:#4285F4;display:flex;align-items:center;justify-content:center;gap:8px;">
        <svg width="18" height="18" viewBox="0 0 24 24">
          <path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Sign in with Google
      </button>
      <div id="authError" style="color:var(--danger);font-size:0.95rem;min-height:20px;text-align:center;font-weight:500;"></div>
    </div>
  </div>
  <main class="main">
    <section class="tool-card" id="wordcount-tool">
      <h1>Word Count Tool</h1>
      <div class="controls">
        <div id="dropZone" style="width:100%;height:100px;border:2px dashed #0066cc;border-radius:10px;padding:48px 0;margin-bottom:20px;text-align:center;transition:background 0.2s;">Drag & Drop a .txt file here</div>
        <input type="file" id="fileInput" accept=".txt" aria-label="Open text file">
        <button class="action-btn" id="clearBtn" aria-label="Clear text area">Clear</button>
        <button class="action-btn" id="copyBtn" aria-label="Copy text">Copy</button>
      </div>
      <div class="textarea-wrap">
        <textarea id="textInput" placeholder="Type or paste your text here..." aria-label="Text input area"></textarea>
      </div>
      <div class="count-row">
        <span class="word-count" id="wordCount">Word Count: 0</span>
        <span class="char-count" id="charCount">Characters: 0</span>
      </div>
      <div class="toast" id="toast">Copied!</div>
    </section>
    <section class="tool-card" id="search-tool" style="display:none;">
      <h1>Search Word</h1>
      <div class="replace-controls">
        <input type="text" id="searchInput" placeholder="Enter word or phrase to search" style="flex:1;min-width:120px;" aria-label="Search word">
        <button class="action-btn" id="searchBtn">Search</button>
      </div>
      <div class="textarea-wrap">
        <textarea id="searchTextArea" readonly style="background:#f4f8fb;"></textarea>
      </div>
      <div class="count-row">
        <span class="word-count" id="searchCount">Matches: 0</span>
      </div>
    </section>
    <section class="tool-card" id="replace-tool" style="display:none;">
      <h1>Replace Word</h1>
      <div class="replace-controls">
        <input type="text" id="findInput" placeholder="Find..." aria-label="Find word">
        <input type="text" id="replaceInput" placeholder="Replace with..." aria-label="Replace with">
        <button class="replace-btn" id="replaceBtn">Replace All</button>
      </div>
      <div class="textarea-wrap">
        <textarea id="replaceTextArea" readonly style="background:#f4f8fb;"></textarea>
      </div>
      <div class="count-row">
        <span class="word-count" id="replaceCount">Replacements: 0</span>
      </div>
    </section>
    <section class="tool-card" id="stats-tool" style="display:none;">
      <h1>Text Statistics</h1>
      <div class="textarea-wrap">
        <textarea id="statsTextArea" readonly style="background:#f4f8fb;"></textarea>
      </div>
      <div class="count-row">
        <span class="sentence-count" id="sentenceCount">Sentences: 0</span>
        <span class="para-count" id="paraCount">Paragraphs: 0</span>
        <span class="reading-time" id="readingTime">Reading Time: 0 min</span>
      </div>
    </section>
    <section class="tool-card" id="case-tool" style="display:none;">
      <h1>Case Converter</h1>
      <div class="case-controls">
        <button class="case-btn" data-case="upper">UPPERCASE</button>
        <button class="case-btn" data-case="lower">lowercase</button>
        <button class="case-btn" data-case="title">Title Case</button>
        <button class="case-btn" data-case="sentence">Sentence case</button>
      </div>
      <div class="textarea-wrap">
        <textarea id="caseTextArea" readonly style="background:#f4f8fb;"></textarea>
      </div>
    </section>
    <section class="tool-card" id="aiWriter-tool" style="display:none;">
      <h1>AI-Powered Content Writer</h1>
      <div class="ai-prompt-section" style="margin-bottom:20px;">
        <div class="prompt-templates" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
          <button class="prompt-btn" data-prompt="essay">Essay Writer</button>
          <button class="prompt-btn" data-prompt="blog">Blog Post</button>
          <button class="prompt-btn" data-prompt="story">Story Writer</button>
          <button class="prompt-btn" data-prompt="email">Email Writer</button>
          <button class="prompt-btn" data-prompt="summary">Text Summarizer</button>
          <button class="prompt-btn" data-prompt="rewrite">Content Rewriter</button>
        </div>
        <div class="textarea-wrap">
          <textarea id="promptInput" placeholder="Describe what you want to write about..." style="min-height:80px;font-size:1rem;padding:12px 14px;border:1.5px solid #cfd8dc;border-radius:10px;resize:vertical;background:#f4f8fb;font-family:inherit;box-sizing:border-box;width:100%;" aria-label="AI Prompt"></textarea>
        </div>
        <div class="ai-options" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px;">
          <label style="display:flex;align-items:center;gap:6px;font-size:1rem;color:#333;">
            <input type="number" id="wordCountInput" value="300" min="50" max="2000" style="width:80px;padding:4px 8px;border:1.5px solid #cfd8dc;border-radius:4px;font-size:0.9rem;">
            Words
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:1rem;color:#333;">
            <select id="toneSelect" style="padding:4px 8px;border:1.5px solid #cfd8dc;border-radius:4px;font-size:0.9rem;">
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
              <option value="academic">Academic</option>
              <option value="creative">Creative</option>
              <option value="persuasive">Persuasive</option>
            </select>
            Tone
          </label>
          <button class="action-btn" id="generateBtn" style="background:var(--accent);">Generate Content</button>
        </div>
      </div>
      <div class="textarea-wrap">
        <textarea id="aiOutput" placeholder="AI-generated content will appear here..." readonly style="background:#f4f8fb;min-height:200px;"></textarea>
      </div>
      <div class="ai-actions" style="display:flex;gap:10px;margin-top:12px;">
        <button class="utility-btn" id="copyAiBtn">Copy Content</button>
        <button class="utility-btn" id="replaceMainBtn">Replace Main Text</button>
        <button class="utility-btn" id="appendBtn">Append to Main</button>
        <button class="utility-btn" id="clearAiBtn">Clear Output</button>
      </div>
      <div class="ai-status" id="aiStatus" style="margin-top:12px;padding:8px 12px;border-radius:6px;font-size:0.9rem;display:none;"></div>
    </section>
    <section class="tool-card" id="download-tool" style="display:none;">
      <h1>Download Text</h1>
      <div class="controls">
        <button class="action-btn" id="downloadBtn">Download as .txt</button>
      </div>
      <div class="textarea-wrap">
        <textarea id="downloadTextArea" readonly style="background:#f4f8fb;"></textarea>
      </div>
    </section>
  </main>
  <script>
    // --- Theme Management ---
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    
    // Get saved theme from localStorage or default to 'light'
    let currentTheme = localStorage.getItem('theme') || 'light';
    
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      currentTheme = theme;
      localStorage.setItem('theme', theme);
      
      // Update theme icon
      themeIcon.textContent = theme === 'dark' ? '☀️' : '🌙';
    }
    
    // Initialize theme
    setTheme(currentTheme);
    
    // Theme toggle event listener
    themeToggle.addEventListener('click', () => {
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    });

    // --- Shared State ---
    let mainText = '';
    // --- Sidebar Navigation ---
    const navBtns = document.querySelectorAll('.nav-btn');
    const toolSections = {
      wordcount: document.getElementById('wordcount-tool'),
      search: document.getElementById('search-tool'),
      replace: document.getElementById('replace-tool'),
      stats: document.getElementById('stats-tool'),
      case: document.getElementById('case-tool'),
      aiWriter: document.getElementById('aiWriter-tool'),
      download: document.getElementById('download-tool'),
    };
    function showTool(tool) {
      Object.entries(toolSections).forEach(([k, sec]) => {
        sec.style.display = (k === tool) ? '' : 'none';
      });
      navBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.tool === tool));
      // Sync text to each tool
      syncAllTools();
    }
    navBtns.forEach(btn => {
      btn.addEventListener('click', () => showTool(btn.dataset.tool));
    });
    // --- Word Count Tool ---
    const textInput = document.getElementById('textInput');
    const wordCount = document.getElementById('wordCount');
    const charCount = document.getElementById('charCount');
    const fileInput = document.getElementById('fileInput');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const toast = document.getElementById('toast');
    const dropZone = document.getElementById('dropZone');
    let lastWordCount = 0, lastCharCount = 0, toastTimeout = null;
    function animateCount(el, newCount, lastCount) {
      if (newCount !== lastCount) {
        el.classList.add('count-animate');
        setTimeout(() => el.classList.remove('count-animate'), 350);
      }
    }
    function updateCounts() {
      const text = textInput.value.trim();
      let words = 0;
      let chars = textInput.value.length;
      if (text.length > 0) {
        words = text.split(/\s+/).length;
      }
      animateCount(wordCount, words, lastWordCount);
      animateCount(charCount, chars, lastCharCount);
      wordCount.textContent = `Word Count: ${words}`;
      charCount.textContent = `Characters: ${chars}`;
      lastWordCount = words;
      lastCharCount = chars;
      mainText = textInput.value;
      syncAllTools();
    }
    textInput.addEventListener('input', updateCounts);
    // Drag & Drop for files
    ['dragenter','dragover'].forEach(evt => dropZone.addEventListener(evt, e => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.style.background = 'var(--input-bg)';
    }));
    ['dragleave','drop'].forEach(evt => dropZone.addEventListener(evt, e => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.style.background = '';
    }));
    dropZone.addEventListener('drop', e => {
      const file = e.dataTransfer.files[0];
      if (file && file.type === 'text/plain') {
        const reader = new FileReader();
        reader.onload = function(ev) {
          textInput.value = ev.target.result;
          updateCounts();
          highlightTextarea(textInput);
        };
        reader.readAsText(file);
      } else if (file) {
        showToast('Please drop a .txt file.', true);
      }
    });
    clearBtn.addEventListener('click', () => {
      textInput.value = '';
      updateCounts();
      highlightTextarea(textInput);
    });
    copyBtn.addEventListener('click', () => {
      textInput.select();
      document.execCommand('copy');
      showToast('Copied!');
      highlightTextarea(textInput);
    });
    function showToast(message, isError = false) {
      toast.textContent = message;
      toast.style.background = isError ? 'var(--danger)' : 'var(--accent)';
      toast.classList.add('show');
      if (toastTimeout) clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, 1700);
    }
    function highlightTextarea(el) {
      el.classList.add('highlight');
      setTimeout(() => el.classList.remove('highlight'), 500);
    }
    // --- Search Tool ---
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const searchTextArea = document.getElementById('searchTextArea');
    const searchCount = document.getElementById('searchCount');
    function highlightAll(text, search) {
      if (!search) return text;
      const esc = search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      return text.replace(new RegExp(esc, 'gi'), match => `<span class="highlight-search">${match}</span>`);
    }
    function updateSearch() {
      const search = searchInput.value;
      const text = mainText;
      if (!search) {
        searchTextArea.value = text;
        searchCount.textContent = 'Matches: 0';
        return;
      }
      const regex = new RegExp(search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
      const matches = text.match(regex);
      searchCount.textContent = `Matches: ${matches ? matches.length : 0}`;
      // For display, highlight in a div, then set textarea value (strip tags for textarea)
      const highlighted = highlightAll(text, search);
      // Show highlighted in a div overlay
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = highlighted.replace(/\n/g, '<br>');
      searchTextArea.value = tempDiv.textContent;
      // For real highlight, would use a contenteditable div, but for now, just show count
    }
    searchBtn.addEventListener('click', updateSearch);
    searchInput.addEventListener('input', updateSearch);
    // --- Replace Tool ---
    const findInput = document.getElementById('findInput');
    const replaceInput = document.getElementById('replaceInput');
    const replaceBtn = document.getElementById('replaceBtn');
    const replaceTextArea = document.getElementById('replaceTextArea');
    const replaceCount = document.getElementById('replaceCount');
    function updateReplace() {
      const find = findInput.value;
      const replace = replaceInput.value;
      let text = mainText;
      if (!find) {
        replaceTextArea.value = text;
        replaceCount.textContent = 'Replacements: 0';
        return;
      }
      const regex = new RegExp(find.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
      const matches = text.match(regex);
      replaceCount.textContent = `Replacements: ${matches ? matches.length : 0}`;
      if (matches) {
        text = text.replace(regex, replace);
      }
      replaceTextArea.value = text;
    }
    findInput.addEventListener('input', updateReplace);
    replaceInput.addEventListener('input', updateReplace);
    replaceBtn.addEventListener('click', () => {
      // Apply replace to main text
      const find = findInput.value;
      const replace = replaceInput.value;
      if (!find) return;
      const regex = new RegExp(find.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
      mainText = mainText.replace(regex, replace);
      textInput.value = mainText;
      updateCounts();
      showToast('Replaced!');
      syncAllTools();
    });
    // --- Statistics Tool ---
    const statsTextArea = document.getElementById('statsTextArea');
    const sentenceCount = document.getElementById('sentenceCount');
    const paraCount = document.getElementById('paraCount');
    const readingTime = document.getElementById('readingTime');
    function updateStats() {
      const text = mainText;
      const sentences = (text.match(/[^.!?]+[.!?]+/g) || []).length;
      const paragraphs = (text.split(/\n{2,}/).filter(p => p.trim().length > 0)).length;
      const words = text.trim().length > 0 ? text.trim().split(/\s+/).length : 0;
      const chars = text.length;
      const wpm = 200;
      const mins = Math.ceil(words / wpm);
      statsTextArea.value = text;
      sentenceCount.textContent = `Sentences: ${sentences}`;
      paraCount.textContent = `Paragraphs: ${paragraphs}`;
      readingTime.textContent = `Reading Time: ${mins} min`;
    }
    // --- Case Converter Tool ---
    const caseTextArea = document.getElementById('caseTextArea');
    const caseBtns = document.querySelectorAll('.case-btn');
    function toTitleCase(str) {
      return str.replace(/\w\S*/g, w => w.charAt(0).toUpperCase() + w.substr(1).toLowerCase());
    }
    function toSentenceCase(str) {
      return str.replace(/(^|[.!?]\s+)([a-z])/g, (m, p1, p2) => p1 + p2.toUpperCase());
    }
    caseBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        let text = mainText;
        switch (btn.dataset.case) {
          case 'upper': text = text.toUpperCase(); break;
          case 'lower': text = text.toLowerCase(); break;
          case 'title': text = toTitleCase(text); break;
          case 'sentence': text = toSentenceCase(text); break;
        }
        caseTextArea.value = text;
        showToast('Converted!');
      });
    });
    // --- Download Tool ---
    const downloadBtn = document.getElementById('downloadBtn');
    const downloadTextArea = document.getElementById('downloadTextArea');
    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([mainText], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'text.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('Downloaded!');
    });
    // --- Sync All Tools ---
    function syncAllTools() {
      // Sync text to all tool textareas
      searchTextArea.value = mainText;
      replaceTextArea.value = mainText;
      statsTextArea.value = mainText;
      caseTextArea.value = mainText;
      downloadTextArea.value = mainText;
      updateSearch();
      updateReplace();
      updateStats();
    }
    // --- Initial Setup ---
    showTool('wordcount');
    updateCounts();
    // Accessibility: allow tab to buttons
    [clearBtn, copyBtn, fileInput, textInput].forEach(el => {
      el.tabIndex = 0;
    });
    // Responsive sidebar toggle for mobile
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarNavLinks = document.getElementById('sidebarNavLinks');
    function handleResize() {
      if (window.innerWidth <= 900) {
        sidebarToggle.style.display = 'flex';
        sidebarNavLinks.style.display = 'none';
      } else {
        sidebarToggle.style.display = 'none';
        sidebarNavLinks.style.display = '';
      }
    }
    sidebarToggle && sidebarToggle.addEventListener('click', () => {
      if (sidebarNavLinks.style.display === 'none') {
        sidebarNavLinks.style.display = '';
      } else {
        sidebarNavLinks.style.display = 'none';
      }
    });
    window.addEventListener('resize', handleResize);
    window.addEventListener('DOMContentLoaded', handleResize);
  </script>
  <script type="module">
    import { login, signup, loginWithGoogle, logout, onAuthChange } from './firebase/auth.js';
    
    let currentUser = null;

    function showAuthModal(show = true) {
      authModal.style.display = show ? 'flex' : 'none';
    }

    function blockTools(block = true) {
      document.querySelector('main').style.pointerEvents = block ? 'none' : '';
      document.querySelector('main').style.opacity = block ? 0.4 : 1;
    }

    function resetAuthForm() {
      authEmail.value = '';
      authPassword.value = '';
      authError.textContent = '';
    }

    function showError(message) {
      authError.textContent = message;
      console.error('Authentication error:', message);
    }

    function showProfileSection(show = true, user = null) {
      const profileSection = document.getElementById('profileSection');
      const profileEmail = document.getElementById('profileEmail');
      const profileAvatar = document.getElementById('profileAvatar');
      
      if (profileSection) {
        profileSection.style.display = show ? 'block' : 'none';
      }
      
      if (show && user) {
        profileEmail.textContent = user.email;
        // Set avatar initial from email or display name
        const displayName = user.displayName || user.email.split('@')[0];
        profileAvatar.textContent = displayName.charAt(0).toUpperCase();
      }
    }

    function showEditProfileModal(show = true, user = null) {
      const editProfileModal = document.getElementById('editProfileModal');
      const editDisplayName = document.getElementById('editDisplayName');
      const editEmail = document.getElementById('editEmail');
      const editBio = document.getElementById('editBio');
      
      if (editProfileModal) {
        editProfileModal.style.display = show ? 'flex' : 'none';
      }
      
      if (show && user) {
        editDisplayName.value = user.displayName || '';
        editEmail.value = user.email || '';
        editBio.value = user.bio || '';
      }
    }

    function showProfileError(message) {
      const profileError = document.getElementById('profileError');
      const profileSuccess = document.getElementById('profileSuccess');
      if (profileError) {
        profileError.textContent = message;
        profileSuccess.textContent = '';
      }
    }

    function showProfileSuccess(message) {
      const profileError = document.getElementById('profileError');
      const profileSuccess = document.getElementById('profileSuccess');
      if (profileSuccess) {
        profileSuccess.textContent = message;
        profileError.textContent = '';
      }
    }

    // Profile dropdown functionality
    const profileToggle = document.getElementById('profileToggle');
    const profileDropdown = document.getElementById('profileDropdown');
    
    if (profileToggle && profileDropdown) {
      profileToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle('show');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!profileToggle.contains(e.target) && !profileDropdown.contains(e.target)) {
          profileDropdown.classList.remove('show');
        }
      });
    }

    // Edit profile functionality
    const editProfileBtn = document.getElementById('editProfileBtn');
    const closeEditProfile = document.getElementById('closeEditProfile');
    const cancelEditProfile = document.getElementById('cancelEditProfile');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    
    if (editProfileBtn) {
      editProfileBtn.addEventListener('click', () => {
        profileDropdown.classList.remove('show');
        showEditProfileModal(true, currentUser);
      });
    }
    
    if (closeEditProfile) {
      closeEditProfile.addEventListener('click', () => {
        showEditProfileModal(false);
      });
    }
    
    if (cancelEditProfile) {
      cancelEditProfile.addEventListener('click', () => {
        showEditProfileModal(false);
      });
    }
    
    if (saveProfileBtn) {
      saveProfileBtn.addEventListener('click', async () => {
        const displayName = document.getElementById('editDisplayName').value.trim();
        const bio = document.getElementById('editBio').value.trim();
        
        try {
          // Here you would typically update the user profile in Firebase
          // For now, we'll just show a success message
          showProfileSuccess('Profile updated successfully!');
          
          // Update the avatar if display name changed
          if (displayName && currentUser) {
            const profileAvatar = document.getElementById('profileAvatar');
            profileAvatar.textContent = displayName.charAt(0).toUpperCase();
          }
          
          setTimeout(() => {
            showEditProfileModal(false);
          }, 1500);
        } catch (error) {
          showProfileError('Failed to update profile. Please try again.');
        }
      });
    }

    // Settings and Help buttons
    const settingsBtn = document.getElementById('settingsBtn');
    const helpBtn = document.getElementById('helpBtn');
    
    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => {
        profileDropdown.classList.remove('show');
        showToast('Settings feature coming soon!');
      });
    }
    
    if (helpBtn) {
      helpBtn.addEventListener('click', () => {
        profileDropdown.classList.remove('show');
        showToast('Help & Support feature coming soon!');
      });
    }

    loginBtn.onclick = async () => {
      authError.textContent = '';
      const email = authEmail.value.trim();
      const password = authPassword.value;
      
      if (!email || !password) {
        showError('Please enter both email and password.');
        return;
      }
      
      try {
        console.log('Attempting login...');
        await login(email, password);
      } catch (e) {
        showError(e.message);
      }
    };
    
    signupBtn.onclick = async () => {
      authError.textContent = '';
      const email = authEmail.value.trim();
      const password = authPassword.value;
      
      if (!email || !password) {
        showError('Please enter both email and password.');
        return;
      }
      
      if (password.length < 6) {
        showError('Password must be at least 6 characters long.');
        return;
      }
      
      try {
        console.log('Attempting signup...');
        await signup(email, password);
      } catch (e) {
        showError(e.message);
      }
    };
    
    googleBtn.onclick = async () => {
      authError.textContent = '';
      try {
        console.log('Attempting Google sign-in...');
        await loginWithGoogle();
      } catch (e) {
        showError(e.message);
      }
    };

    // New logout button event listener
    const logoutBtnNew = document.getElementById('logoutBtnNew');
    if (logoutBtnNew) {
      logoutBtnNew.addEventListener('click', async () => {
        try {
          await logout();
        } catch (e) {
          console.error('Logout error:', e);
          showError('Logout failed. Please try again.');
        }
      });
    }

    onAuthChange(user => {
      currentUser = user;
      if (user) {
        showAuthModal(false);
        blockTools(false);
        showProfileSection(true, user);
        console.log('User logged in:', user.email);
      } else {
        showAuthModal(true);
        blockTools(true);
        showProfileSection(false);
        resetAuthForm();
        console.log('User logged out');
      }
    });

    // Block tools until login on page load
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded, checking authentication...');
      if (!currentUser) {
        showAuthModal(true);
        blockTools(true);
        showProfileSection(false);
      }
    });
  </script>
  <script type="module" src="firebase/ai-writer.js"></script>
</body>
</html> 